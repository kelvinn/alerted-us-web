language: python

services:
  - docker

branches:
  only:
  - master
  - /^dependabot.*$/

jobs:
  include:
    - stage: install
      script: sudo apt-get install python3-venv python3-pip
    - stage: tests
      script: sudo apt-get install python3-venv && bash ./scripts/ci_tests.sh
    - stage: coverage
      script: bash ./scripts/coveralls.sh
    - stage: deploy to staging
      script: skip
      deploy:
        provider: script
        script: bash scripts/deploy.sh $APP_NAME $STAGING_SMOKE_URL
        on:
          branch: master
    - stage: deploy to production
      script: skip
      deploy:
        provider: script
        script: bash scripts/deploy.sh $PRODUCTION_APP_NAME $PRODUCTION_SMOKE_URL
        on:
          branch: master